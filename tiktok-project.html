<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TikTok → MP4 変換ツール - プロジェクト詳細</title>
    <meta name="description" content="高可用性フォールバック設計によるTikTok動画ダウンロードWebアプリケーション">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- ナビゲーション -->
    <nav class="navigation" id="navigation">
        <div class="nav-content">
            <a href="index.html" class="nav-brand" aria-label="ホームに戻る">鈴木皆人</a>
            
            <ul class="nav-links" role="menubar">
                <li role="none"><a href="index.html#home" class="nav-link" role="menuitem">ホーム</a></li>
                <li role="none"><a href="index.html#projects" class="nav-link active" role="menuitem">プロジェクト</a></li>
                <li role="none"><a href="index.html#about" class="nav-link" role="menuitem">プロフィール</a></li>
                <li role="none"><a href="index.html#contact" class="nav-link" role="menuitem">コンタクト</a></li>
            </ul>
            
            <div class="contact-dropdown">
                <button class="button button-primary tappable contact-trigger" aria-label="お問い合わせ方法を選択" aria-expanded="false">
                    お問い合わせ
                    <span class="dropdown-icon">▾</span>
                </button>
                <div class="contact-options" role="menu" aria-hidden="true">
                    <a href="mailto:minato2ban@icloud.com?subject=%E3%83%9D%E3%83%BC%E3%83%88%E3%83%95%E3%82%A9%E3%83%AA%E3%82%AA%E3%82%B5%E3%82%A4%E3%83%88%E3%81%8B%E3%82%89%E3%81%AE%E3%81%8A%E5%95%8F%E3%81%84%E5%90%88%E3%82%8F%E3%81%9B&body=%E3%81%AF%E3%81%98%E3%82%81%E3%81%BE%E3%81%97%E3%81%A6%E3%80%82%0D%0A%0D%0A%E3%81%8A%E5%90%8D%E5%89%8D%EF%BC%9A%0D%0A%E3%81%94%E7%94%A8%E4%BB%B6%EF%BC%9A%0D%0A%0D%0A%E3%82%88%E3%82%8D%E3%81%97%E3%81%8F%E3%81%8A%E9%A1%98%E3%81%84%E3%81%84%E3%81%9F%E3%81%97%E3%81%BE%E3%81%99%E3%80%82" 
                       class="contact-option" role="menuitem">
                        <span class="contact-icon">✉️</span>
                        メールアプリで開く
                    </a>
                    <button class="contact-option copy-email-btn" role="menuitem" data-email="minato2ban@icloud.com">
                        <span class="contact-icon">📋</span>
                        メールアドレスをコピー
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <main>
        <!-- プロジェクトヒーロー -->
        <section class="project-hero section">
            <div class="container">
                <a href="index.html#projects" class="back-button">プロジェクト一覧に戻る</a>
                
                <h1>TikTok → MP4 変換ツール</h1>
                <p class="hero-subtitle">多段APIフォールバックと安全なダウンロード</p>
                
                <p class="hero-description">
                    無料のTikTokダウンロードAPIを順番に試行し、取得した動画をサーバーでサイズ上限付きストリーム保存してからダウンロードリンクを返すシンプルなWebアプリです。CORS許可リストや自動クリーンアップを備え、公開運用でも扱いやすい設計にしています。
                </p>
            </div>
        </section>

        <!-- プロジェクト詳細 -->
        <section class="section">
            <div class="container">
                <!-- デモ動画 & GitHub -->
                <div>
                    <h2>デモ動画</h2>
                    <div class="media-frame" style="margin-top: var(--space-4);">
                        <video controls preload="metadata" playsinline>
                            <source src="videos/tiktok-demo.mp4" type="video/mp4">
                            お使いのブラウザは動画に対応していません。
                        </video>
                    </div>

                    <div class="repo-links">
                        <a href="https://github.com/Minatoo00/tiktok-to-mp4-converter" class="button button-secondary" target="_blank" rel="noopener">GitHub リポジトリ</a>
                        <a href="https://github.com/Minatoo00/tiktok-to-mp4-converter#readme" class="button button-tertiary" target="_blank" rel="noopener">README</a>
                    </div>
                </div>

                <!-- プロジェクトメタ情報 -->
                <div class="project-meta">
                    <div class="project-meta-item">
                        <div class="project-meta-label">プロジェクト期間</div>
                        <div class="project-meta-value">2025年3月</div>
                    </div>
                    
                    <div class="project-meta-item">
                        <div class="project-meta-label">役割</div>
                        <div class="project-meta-value">フルスタック開発・インフラ設計</div>
                    </div>
                    
                    <div class="project-meta-item">
                        <div class="project-meta-label">プロジェクト種別</div>
                        <div class="project-meta-value">個人開発・実用ツール</div>
                    </div>
                </div>

                <!-- 課題と解決アプローチ -->
                <div class="grid grid-2" style="margin-top: var(--space-8);">
                    <div>
                        <h2>作成の動機</h2>
                        <p>TikTok動画をMP4形式でダウンロードしたい時、既存の外部サービスは広告が多かったり、有料のものがあったりして使いにくいと感じました。そこで、シンプルで使いやすい自分専用のツールを作成することにしました。</p>
                        
                        <ul class="feature-list">
                            <li>広告なしでストレスフリーな操作環境</li>
                            <li>必要な機能だけに絞ったシンプルな設計</li>
                            <li>自分で管理できる安心感とプライバシー保護</li>
                        </ul>
                    </div>

                    <div>
                        <h2>技術的アプローチ</h2>
                        <p>信頼性を重視した3層のフォールバック戦略で、様々な状況に対応できる堅牢なシステムを構築しました：</p>
                        
                        <div class="highlight-box">
                            <h4>Layer 1: 公開APIフォールバック</h4>
                            <p>TikWM / SSSTik / SnapTik / TiklyDown の4 APIを15秒タイムアウトで順に試し、最初に得られたHDまたは標準画質のURLを採用します。</p>
                        </div>

                        <div class="highlight-box">
                            <h4>Layer 2: 安全なストリーム保存</h4>
                            <p>取得した動画URLをサーバーでストリーム保存し、Content-Lengthと受信バイト数を上限（デフォルト80MB）で監視。超過時は即中断してユーザーに再試行を促します。</p>
                        </div>
                        
                        <div class="highlight-box">
                            <h4>Layer 3: 配布とクリーンアップ</h4>
                            <p>ダウンロード専用ルートで安全に配布し、ダウンロード後またはTTL（デフォルト30分）経過で自動削除。誤公開やストレージ逼迫を防ぎます。</p>
                        </div>
                    </div>
                </div>

                <!-- 主要機能 -->
                <div style="margin-top: var(--space-8);">
                    <h2>主要機能</h2>
                    <p class="text-sub">外部APIへの依存を前提に、失敗時の挙動をできるだけ穏やかにする多層フォールバックを用意しました。</p>
                    
                    <div class="grid grid-auto" style="margin-top: var(--space-6);">
                        <div class="card">
                            <h3>🔄 多段階フォールバック</h3>
                            <p>複数の変換手法を組み合わせて、失敗時の代替手段を確保。一つの方法が失敗しても自動的に次の方法を試行します。</p>
                            <ul class="feature-list">
                                <li>外部API群（TikWM / SSSTik / SnapTik / TiklyDown）の順次試行</li>
                                <li>APIごとにレスポンス形式をパースする軽量ロジック</li>
                                <li>タイムアウト時は即次のAPIへ切り替え</li>
                            </ul>
                        </div>

                        <div class="card">
                            <h3>⚡ 高速ストリーム処理</h3>
                            <p>Node.jsのストリームでメモリ消費を抑えつつ、上限監視と不完全ファイル削除を組み合わせて安全にダウンロードします。</p>
                            <ul class="feature-list">
                                <li>ストリーミングによるメモリ効率化</li>
                                <li>自動ファイル名生成（クリーンなタイトル+タイムスタンプ+UUID）</li>
                                <li>Content-Lengthと受信バイト数でサイズ上限を監視</li>
                            </ul>
                        </div>

                        <div class="card">
                            <h3>🎯 シンプルなUI/UX</h3>
                            <p>「URL入力→変換開始」の最小ステップで完了。成功／失敗を明確に表示し、再試行ボタンで迷わない導線を意識しました。</p>
                            <ul class="feature-list">
                                <li>URL入力→変換開始の2ステップ操作</li>
                                <li>変換中のローディング表示と簡潔なエラーメッセージ</li>
                                <li>成功時はタイトル/作成者/品質/ファイル名を提示</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- 開発で得た知見 -->
                <div style="margin-top: var(--space-8);">
                    <h2>開発で得た知見</h2>
                    <p class="text-sub">外部サービスに依存しながらも、ユーザーに迷惑をかけないための現実的な守り方を学びました。</p>
                    
                    <div class="grid grid-2">
                        <div>
                            <h3>多層フォールバックの設計</h3>
                            <ul class="feature-list">
                                <li>APIごとにレスポンス形式が異なるため、最小限のパーサを用意して失敗時も続きを試す設計の大切さ。</li>
                                <li>タイムアウトを短く区切り、失敗に素早く気付いて次の手段に移る方が体感的な成功率を上げること。</li>
                                <li>外部依存が多いサービスでは、ユーザー向けメッセージを簡潔に保ち、内部ログで詳細を残す二段構えが有効。</li>
                            </ul>
                        </div>

                        <div>
                            <h3>ストリーム処理と安全性</h3>
                            <ul class="feature-list">
                                <li>Content-Lengthと受信バイト数を両方監視して、サイズ爆弾を早期遮断する仕組みが必要。</li>
                                <li>ダウンロード後削除やTTLクリーンアップを入れると、ストレージ運用がぐっと楽になる。</li>
                                <li>タイトル整形＋UUIDで分かりやすさと衝突回避を両立できる。</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- エラーハンドリング戦略 -->
                <div style="margin-top: var(--space-8);">
                    <h2>エラーハンドリング</h2>
                    <p class="text-sub">失敗は必ず起きる前提で、ユーザーには簡潔な案内を、サーバーには原因特定のログを残すようにしました。</p>
                    
                    <div class="grid grid-auto" style="margin-top: var(--space-6);">
                        <div class="card">
                            <h3>🔍 詳細なエラー分類</h3>
                            <ul class="feature-list">
                                <li>HTTPステータスやレスポンス形式不正を判別してフォールバック</li>
                                <li>APIは15秒、ダウンロードは30秒のタイムアウトで早めに切り替え</li>
                                <li>サイズ超過エラーをユーザーに明示</li>
                            </ul>
                        </div>

                        <div class="card">
                            <h3>📊 ログとモニタリング</h3>
                            <ul class="feature-list">
                                <li>各API試行の成否と選択品質をコンソールに記録</li>
                                <li>Content-Lengthの有無や想定外MIMEを警告ログで把握</li>
                                <li>ユーザーには簡潔なメッセージのみ返して詳細はサーバー側に保持</li>
                            </ul>
                        </div>

                        <div class="card">
                            <h3>🛡️ 堅牢なファイル処理</h3>
                            <ul class="feature-list">
                                <li>ダウンロード中断時に部分ファイルを即削除</li>
                                <li>保存ディレクトリの存在確認と自動作成</li>
                                <li>TTLおよび「ダウンロード後削除」で不要ファイルを残さない</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- 使用技術 -->
                <div style="margin-top: var(--space-8);">
                    <h2>使用技術</h2>
                    
                    <div class="grid grid-2">
                        <div>
                            <h3>バックエンド</h3>
                            <div class="skill-tags">
                                <span class="skill-tag">Node.js</span>
                                <span class="skill-tag">Express</span>
                                <span class="skill-tag">axios</span>
                                <span class="skill-tag">uuid</span>
                                <span class="skill-tag">CORS</span>
                            </div>
                        </div>

                        <div>
                            <h3>フロントエンド・UI</h3>
                            <div class="skill-tags">
                                <span class="skill-tag">JavaScript</span>
                                <span class="skill-tag">HTML/CSS</span>
                                <span class="skill-tag">Fetch API</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 設計思想 -->
                <div class="highlight-box" style="margin-top: var(--space-8);">
                    <h4>設計で重視した考え方</h4>
                    <p><strong>信頼性を最優先とした堅牢な設計</strong>：外部サービスに依存する以上、障害は必ず発生すると考え、複数APIのフォールバックとサイズ監視付きストリーム保存、TTLクリーンアップまでを一連の流れとして組み込みました。どこかで失敗してもユーザー体験が極端に悪化しないよう、早めの切り替えと簡潔な案内を心がけています。</p>
                </div>

                <!-- 成果と学び -->
                <div style="margin-top: var(--space-8);">
                    <h2>成果と学び</h2>
                    
                    <div class="grid grid-2">
                        <div>
                            <h3>実装できた機能</h3>
                            <ul class="feature-list">
                                <li>3層フォールバック機能による高い変換成功率</li>
                                <li>ストリーミング処理による大容量ファイル対応</li>
                                <li>詳細なエラー分類とログ記録システム</li>
                            </ul>
                        </div>

                        <div>
                            <h3>実装上の課題と改善点</h3>
                            <ul class="feature-list">
                                <li><strong>UX:</strong> 進捗表示がないため長尺動画で不安を与えてしまう。簡単なステップインジケータを入れて安心感を出す必要あり。</li>
                                <li><strong>パフォーマンス・最適化:</strong> 依存APIが遅いとそのまま待たせてしまう。並列プリフライトや失敗理由別の短タイムアウト調整をまだ入れられていない。</li>
                                <li><strong>アクセシビリティ:</strong> 通知が色とアイコン頼みで、スクリーンリーダー向けの `aria-live` などが不足。視覚以外の手がかりを追加したい。</li>
                                <li><strong>コード品質・アーキテクチャ:</strong> ロジックが `app.js` に集約され過ぎており、テストも未整備。ダウンロード処理とAPIパーサを分離して単体テストを書きたい。</li>
                                <li><strong>機能要件・ビジネス価値:</strong> 無料API依存でSLA不明・法的リスク説明も弱い。利用規約同意と簡易レートリミットを加え、運用リスクを明示すべき。</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- システムフロー -->
                <div style="margin-top: var(--space-8);">
                    <h2>処理の流れ</h2>
                    <p class="text-sub">URL入力から動画保存まで、失敗に備えた段階的な処理を実行します。</p>
                    
                    <div class="highlight-box" style="margin-top: var(--space-6);">
                        <div style="line-height: 1.8;">
                            <p><strong>1. URL検証</strong> → TikTok / vm.tiktok.com の形式をサーバー側でも確認</p>
                            <p><strong>2. 外部API試行</strong> → TikWM / SSSTik / SnapTik / TiklyDown を順次実行（各15秒タイムアウト）</p>
                            <p><strong>3. ストリーム保存</strong> → 受信バイト数とContent-Lengthでサイズを監視しつつ保存</p>
                            <p><strong>4. ダウンロード配布</strong> → 専用ルートから提供し、必要に応じて即時削除</p>
                            <p><strong>5. 自動クリーンアップ</strong> → TTLが過ぎたファイルをバックグラウンドで削除</p>
                            <p><strong>6. 結果返却</strong> → ダウンロードリンクと動画情報を表示</p>
                        </div>
                    </div>
                </div>

                <!-- 最終プロジェクトリンク -->
                <div style="margin-top: var(--space-8); text-align: center;">
                    <div class="flex flex-center flex-gap">
                        <a href="veo3-project.html" class="button button-secondary">
                            Veo3動画生成ツール
                        </a>
                        <a href="finmajors-project.html" class="button button-secondary">
                            Finmajors News Vol.7
                        </a>
                        <a href="neuro-project.html" class="button button-secondary">
                            脳神経科学アプリ
                        </a>
                        <a href="index.html#projects" class="button button-primary">
                            全プロジェクトに戻る
                        </a>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- フッター -->
    <footer style="background: var(--bg-elev); padding: var(--space-6) 0; text-align: center; border-top: 1px solid var(--border);">
        <div class="container">
            <p class="text-caption">
                © 2025 鈴木皆人（Minato Suzuki）. All rights reserved.
            </p>
        </div>
    </footer>

    <script src="script.js"></script>
</body>
</html>
